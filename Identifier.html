<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Shopify Detector</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                width: 350px;
                min-height: 400px;
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                    Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                color: #333;
            }

            .header h1 {
                font-size: 24px;
                font-weight: 700;
                margin-bottom: 5px;
                position: relative;
                z-index: 1;
            }

            .header p {
                font-size: 14px;
                opacity: 0.9;
                position: relative;
                z-index: 1;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>üõçÔ∏è Shopify Detector</h1>
            <p>Detect Shopify-powered websites instantly</p>
        </div>
        <script>
            // Popup script
            document.addEventListener("DOMContentLoaded", function () {
                const statusDot = document.getElementById("statusDot");
                const statusText = document.getElementById("statusText");
                const currentSite = document.getElementById("currentSite");
                const refreshBtn = document.getElementById("refreshBtn");
                const testBtn = document.getElementById("testBtn");

                // Get current tab info
                chrome.tabs.query(
                    { active: true, currentWindow: true },
                    function (tabs) {
                        const currentTab = tabs[0];
                        currentSite.textContent = currentTab.url;

                        // Check if Shopify is detected
                        checkShopifyStatus(currentTab.id);
                    }
                );

                function checkShopifyStatus(tabId) {
                    statusText.textContent = "Checking...";
                    statusDot.className = "status-dot";

                    // Inject script to check for Shopify
                    chrome.scripting.executeScript(
                        {
                            target: { tabId: tabId },
                            function: function () {
                                return {
                                    hasShopify:
                                        typeof window.Shopify !== "undefined",
                                    hasShopifyMeta: !!document.querySelector(
                                        'meta[name="shopify-checkout-api-version"]'
                                    ),
                                    hasShopifyScripts:
                                        document.querySelectorAll(
                                            'script[src*="shopify"]'
                                        ).length > 0,
                                    hasShopifyElements:
                                        document.querySelectorAll(
                                            '[data-shopify], .shopify-section, [class*="shopify"]'
                                        ).length > 0,
                                    hasCheckoutLinks:
                                        document.querySelectorAll(
                                            'a[href*="checkout.shopify.com"]'
                                        ).length > 0,
                                };
                            },
                        },
                        function (results) {
                            if (results && results[0] && results[0].result) {
                                const detection = results[0].result;
                                const isShopify =
                                    detection.hasShopify ||
                                    detection.hasShopifyMeta ||
                                    detection.hasShopifyScripts ||
                                    detection.hasShopifyElements ||
                                    detection.hasCheckoutLinks;

                                if (isShopify) {
                                    statusDot.className = "status-dot shopify";
                                    statusText.textContent =
                                        "Shopify Detected!";
                                } else {
                                    statusDot.className =
                                        "status-dot not-shopify";
                                    statusText.textContent =
                                        "Not a Shopify Site";
                                }
                            } else {
                                statusDot.className = "status-dot not-shopify";
                                statusText.textContent = "Unable to Detect";
                            }
                        }
                    );
                }

                refreshBtn.addEventListener("click", function () {
                    chrome.tabs.query(
                        { active: true, currentWindow: true },
                        function (tabs) {
                            checkShopifyStatus(tabs[0].id);
                        }
                    );
                });

                testBtn.addEventListener("click", function () {
                    const testSites = [
                        "https://plumgoodness.com/",
                        "https://www.westside.com/",
                        "https://www.shopify.com/",
                        "https://www.google.com/",
                    ];

                    const randomSite =
                        testSites[Math.floor(Math.random() * testSites.length)];
                    chrome.tabs.create({ url: randomSite });
                    window.close();
                });
            });
        </script>
    </body>
</html>
